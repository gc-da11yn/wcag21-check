$(document).ready(function(){$.getJSON("js/json/nav.json",function(t){Nav.init({data:t,$el:$(".main-nav").eq(0)}),Nav.build($("#main_menu")),Nav.firstPage()})});var initialNavigation=!0;const Nav={init:function(t){this.pages=[],this.pageList=[],this.createPages(t.data),this.$el=t.$el,this.currentPage=null},createPages:function(t){let e,i=0;for(let n in t)e=new Page(t[n],this,i),this.pages[n]=e,this.pageList[this.pageList.length]=e,i++},build:function(t){for(let e=0;e<this.pageList.length;e++)this.pageList[e].addToDom(t);this.initDropdown(),this.initBacknext()},initDropdown:function(){let t=this.$el.children("h2").children("button"),e=this.$el.children("ul");this.$el.children("ul").find("div").attr("tabindex","-1"),t.attr("aria-label","Menu. Press Enter to open, then Down to navigate"),t.attr("aria-haspopup","true"),t.attr("aria-controls","main_menu"),t.attr("aria-expanded","false"),e.attr("aria-hidden","true"),this.hideMenu(),this.setEvents()},initBacknext:function(){let t=this;$(".backnext").find("a.prev").click(function(){return initialNavigation=!1,t.prev(),!1}),$(".backnext").find("a.next").click(function(){return initialNavigation=!1,t.next(),!1}),$(".backnext").find("a").attr("aria-controls","dynamic_content")},setPageof:function(){let t=this.currentPage.index+1,e=this.pageList.length,i=t+("fr"===$("html").attr("lang")?" de ":" of ")+e;$(".pageof").html(i)},firstPage:function(){this.loadPage(this.pageList[0])},loadPage:function(t){let e=this;this.currentPage=t;let i=$("#dynamic_content");i.fadeOut(function(){let n="./content/"+t.page+"_"+$("html").attr("lang")+".html";$.get(n,function(n){i.html(n),e.isLoaded(),document.title=t.title}).fail(function(){e.loadFailed(t),document.title=t.title}).always(function(){i.fadeIn(),e.manageFocus()})}),this.setPageof(),this.disableBackNext()},manageFocus:function(){if(!initialNavigation){$("#dynamic_content").find("#pageTitle").focus()}},next:function(){let t=this.pageList.length-1;$("#dynamic_content");this.currentPage.index!==t&&this.loadPage(this.pageList[this.currentPage.index+1])},prev:function(){$("#dynamic_content");0!==this.currentPage.index&&this.loadPage(this.pageList[this.currentPage.index-1])},disableBackNext:function(){let t=this.pageList.length-1,e=$(".prev"),i=$(".next"),n=$(".prev, .next");n.removeClass("disabled"),n.attr("aria-disabled",!1),n.removeAttr("tabindex"),0===this.currentPage.index&&(e.addClass("disabled"),e.attr("aria-disabled",!0),e.attr("tabindex","-1")),this.currentPage.index===t&&(i.addClass("disabled"),i.attr("aria-disabled",!0),i.attr("tabindex","-1"))},isLoaded:function(){$(document).trigger("navigation:pageLoad",[this])},loadFailed:function(t){$("#dynamic_content").html("<h1 id='pageTitle'>Page Load Failed: "+t.title+"</h1>")},setEvents:function(){let t=this,e=(this.$el.children("h2").children("a"),this.$el.children("h2").children("button"));$(window).click(function(e){"mainmenu_link"!==$(e.target).attr("id")&&t.clickOutside()}),e.click(function(e){t.showMenu(),t.pressDown()}),e.keydown(function(e){if("ArrowDown"===e.key)return e.preventDefault(),t.showMenu(),t.pressDown(),!1;"ArrowUp"===e.key?(e.preventDefault(),t.showMenu(),t.pressUp()):"Tab"===e.key&&t.hideMenu()}),document.onkeydown=function(e){"Escape"===e.key&&t.hideMenu()}},clickOutside:function(){this.hideMenu()},showMenu:function(){this.$el.children("h2").children("a").attr("aria-expanded","true"),this.$el.children("ul").show()},hideMenu:function(){this.$el.children("h2").children("a").attr("aria-expanded","false"),this.$el.children("ul").hide()},pressDown:function(){this.pageList[0].setFocus()},pressUp:function(){this.pageList[2].setFocus()},toggleMenu:function(){this.$el.children("ul").toggle()}};function Page(t,e,i){this.parent=e,this.page=t.page,this.title="fr"===$("html").attr("lang")?t.title_fr:t.title,this.navTitle="fr"===$("html").attr("lang")?t.nav_fr:t.nav,this.index=i,this.addToDom=function(t){let e=this;t.append("<div role='menuitem' tabindex='-1' data-page=\""+this.page+'">'+this.navTitle+"</div>"),this.$el=t.children("div").last(),this.$el.attr("aria-controls","dynamic_content"),this.$el.click(function(){e.clickLink()}),this.$el.keydown(function(t){if("ArrowDown"===t.key)return e.focusNextPage(),!1;"ArrowUp"===t.key?(t.preventDefault(),e.focusPrevPage()):"Tab"===t.key?e.parent.hideMenu():"Enter"===t.key&&(e.clickLink(),e.parent.hideMenu())})},this.clickLink=function(){initialNavigation=!1,this.parent.loadPage(this)},this.setFocus=function(){this.$el.focus()},this.loadPage=function(){this.parent.loadPage(this)},this.focusNextPage=function(){let t=this.parent.pageList.length;this.index+1===t?this.parent.pageList[0].setFocus():this.parent.pageList[this.index+1].setFocus()},this.focusPrevPage=function(){let t=this.parent.pageList.length;0===this.index?this.parent.pageList[t-1].setFocus():this.parent.pageList[this.index-1].setFocus()}}function initShowHideButtons(){$(".quite-small").on("click",function(){$("#legBranch:visible").length?($(".quite-small").attr("aria-expanded","false"),$(".quite-small").attr("aria-pressed","false"),$("#legBranch").hide()):($(".quite-small").attr("aria-expanded","true"),$(".quite-small").attr("aria-pressed","true"),$("#legBranch").show())}),$(".focus-rite").on("click",function(){$("#execBranch:visible").length?($(".focus-rite").attr("aria-expanded","false"),$(".focus-rite").attr("aria-pressed","false"),$("#execBranch").hide()):($(".focus-rite").attr("aria-expanded","true"),$(".focus-rite").attr("aria-pressed","true"),$("#execBranch").show())})}function timeout(t){2===t.index&&setTimeout(function(){$(".10-secs").remove()},5e3)}function switchNext(t){1===t.index?($("footer .next").after($("footer .prev")),$("footer .next").after($("footer .pageof"))):($("footer .prev").after($("footer .next")),$("footer .prev").after($("footer .pageof")))}$(document).ready(function(){$(document).on("navigation:pageLoad",function(t,e){timeout(e.currentPage),switchNext(e.currentPage),initShowHideButtons()})});